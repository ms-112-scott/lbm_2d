# LBM-MRT 模擬失敗分析

### 概述
針對 `Circle_003` 和 `Rect_91.1_004` 遮罩的 LBM-MRT 模擬皆持續失敗，其狀態為「Failed (diverged)」，這從 `output/Building_Wind_Sim_multichannel/` 目錄下的 `_batch_run_result.csv` 日誌檔案中可見一斑。記錄中的 `Avg_Vel`、`Max_Ma` 和 `Max_Re` 值均為 `nan` (非數值)，這強烈表明模擬過程中出現了數值不穩定性，導致模擬中斷。

### 失敗詳情

| 遮罩名稱       | 狀態             | 步驟數 | 平均速度 | 最大馬赫數 | 最大雷諾數 | 耗時(秒) |
| :-------------- | :--------------- | :---- | :------ | :----- | :----- | :------ |
| Circle_003      | 失敗 (發散)      | 900   | nan     | nan    | nan    | 5.25    |
| Rect_91.1_004   | 失敗 (發散)      | 900   | nan     | nan    | nan    | 5.23    |

### 可能原因：低黏度 (`niu`) 導致的數值不穩定性

LBM 模擬發散最常見的原因，尤其是在存在障礙物的情況下，是數值不穩定性。這通常源於嘗試模擬高雷諾數流動，在 LBM 語境中，這對應著極低的流體黏度 (`niu`)。

從 `config.yaml` 配置檔案來看，目前的黏度設定為 `niu: 0.005`。儘管配置檔案中的註釋建議 `niu` 值應介於 `0.005` 至 `0.05` 之間以確保數值穩定性，但 `0.005` 位於此建議範圍的最低端。較低的 `niu` 直接導致較高的雷諾數，使得流動更容易產生湍流和數值震盪，進而導致模擬發散。

### 解決建議

1.  **增加黏度 (`niu`):** 首要建議是增加 `config.yaml` 中 `niu` 的值。
    *   首先嘗試將 `niu` 增加到 `0.01` 或 `0.02`。
    *   如果發散問題仍然存在，則逐步進一步增加 (例如 `0.03`, `0.04`, `0.05`)。較高的 `niu` 將使模擬更穩定，但也會降低模擬流動的有效雷諾數。

2.  **檢查遮罩幾何形狀:** 儘管這不太可能是導致普遍發散的主要原因，但仍需確保 `output/masks` 中的遮罩幾何形狀沒有過於薄的區域、單像素寬的連接或可能產生高度局部數值應力的其他特徵。

3.  **審查邊界條件:** 確認邊界條件是否正確應用並與所需的流動場景在物理上保持一致。(目前的 `bc_mode: "no_bound"` 搭配 `types: [0, 0, 1, 0]` 和 `values: [[0.1, 0.0], ...]` 對於帶有障礙物的通道流來說是標準設定)。

透過增加 `niu` 值，模擬應會變得更加數值穩定，使其能夠在不發散的情況下完成並產生有意義的結果。