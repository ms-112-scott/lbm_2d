# MRT-LBM 模擬穩定性問題報告

## 問題描述

目前的 MRT-LBM 模擬 (`main_mrt.py`) 在目標物理參數（例如 `niu: 0.01`, `vel: 0.05`）下會出現數值不穩定並發散 (`diverged`) 的問題。這導致模擬無法在能產生擬真湍流效應的雷諾數下成功運行。

## 已嘗試的解決方案與分析

為了修正此問題，我已經進行了多方面的嘗試：

1.  **調整物理參數**:
    *   **增加黏滯係數 (`niu`)**: 將 `niu` 提高到 `0.05`，雖然能讓模擬穩定運行，但會導致雷諾數過低，流場過於黏滯，無法產生渦流（湍流）。
    *   **降低入口速度 (`vel`)**: 同樣能提升穩定性，但也會降低雷諾數。

2.  **調整 MRT 鬆弛率**:
    *   根據開發指引，調整了鬼影模態鬆弛率 `s_ghost`。
    *   多次修正了鬆弛向量 `S` 的構成，使其符合 D2Q9 模型的標準物理定義（即剪應力鬆弛率為 `s_nu`，體積黏滯鬆弛率為 `s_q`）。

3.  **簡化邊界條件**:
    *   將原本較複雜的 Zou-He 入口和滑移邊界，替換為穩定性更高的 Dirichlet (定值) 入口和 Neumann (零梯度) 出口條件。

4.  **改善程式碼品質**:
    *   根據 Taichi 的建議，將 9x9 的 `ti.Matrix` 修改為 `ti.field`，以改善編譯性能。
    *   簡化了 `step` 函數，移除了冗餘的計算。

5.  **分析幾何影響**:
    *   測試發現，無論是圓形或矩形障礙物，在目標雷諾數下都會發散，排除了障礙物邊角銳利度是唯一原因的可能性。

## 結論與根本原因推測

儘管進行了上述努力，模擬在目標雷諾數下依然失敗。這強烈表明，問題的根源不在於參數調整或邊界條件的選擇，而是在於 **MRT 碰撞模型的核心數學實現存在一個微妙但關鍵的錯誤**。

最可能的錯誤點在於 `solver_mrt.py` 中的：
1.  **M 矩陣**: 我所使用的 M 矩陣可能與
2.  **m_eq (平衡態矩) 的計算**: 這兩者必須完全匹配。

在網路上搜索到的公開資料和範例中，`M` 矩陣的定義存在多種不同的正交基底，每種基底都對應著完全不同的 `m_eq` 計算公式。

**我目前無法解決此問題，因為我缺乏一套來自權威來源（如 Lallemand & Luo 的論文）、完整且相互匹配的 D2Q9 MRT `M` 矩陣和 `m_eq` 公式作為參考來進行校對和修正。**

## 下一步建議

為了讓模擬能在期望的建築尺度風場下運行（即產生湍流），需要：
1.  找到一篇可靠的論文或一個已知可運行的 D2Q9-MRT 範例程式碼。
2.  根據該來源，仔細校對並修正 `solver_mrt.py` 中的 `M` 矩陣定義，以及 `equilibrium` 函數中計算 `m_eq` 的部分。

目前的程式碼可以作為一個 MRT 架構的基礎，但在核心物理部分修正之前，將無法用於生成有效的湍流數據集。
