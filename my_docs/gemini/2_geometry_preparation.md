# 3. 幾何準備

LBM 模擬的第一步，也是最關鍵的一步，就是準備您要模擬的幾何模型。求解器需要一個三維的網格，其中清楚地標示了哪些是流體區域 (空氣)，哪些是固體區域 (建築物)。

## 操作流程

我們已經建立了一個 Python 腳本 `Single_phase/voxelize_geometry.py` 來幫助您將常見的 3D 模型格式 (STL) 轉換為求解器所需的格式。

**如何使用:**

1.  **放置您的 STL 檔案:** 將您的 `.stl` 格式 3D 模型檔案（例如 `my_building.stl`）複製到 `Single_phase` 目錄下。

2.  **編輯設定檔:** 打開 `Single_phase/config.yml` 檔案，並修改 `geometry` 部分的參數：
    ```yaml
    geometry:
      stl_file: my_building.stl  # 替換為您的 STL 檔案名稱 (相對於 Single_phase/ 目錄)
      output_file: geometry.txt  # 輸出的體素化幾何檔案名稱 (將儲存在案例資料夾中)
      voxel_size: 0.5            # 設定您希望的體素大小 (解析度)
    ```

3.  **執行 pipeline:** 在您的終端機中，切換到 `Single_phase` 目錄下，然後執行：
    ```bash
    python run.py
    ```
    (請確保 `config.yml` 中的 `run_mesh` 設定為 `true`)

4.  **檢查輸出:** 腳本會產生一個名為 `geometry.txt` 的檔案，這個檔案將會儲存在 `cases/<您的案例名稱>/` 目錄中，其中包含了您的 3D 模型的體素化表示。同時，腳本也會自動將模型的維度 (dimensions) 更新到 `config.yml` 中的 `simulation` -> `nx, ny, nz`。

## 關於 STL 檔案的大小與單位限制

這是一個非常重要的問題，在使用此模擬流程時您必須了解。

### 大小限制 (記憶體與性能)

程式碼本身**沒有硬性規定** STL 檔案的大小。主要的限制來自於您的**電腦硬體**，特別是 **RAM (記憶體)** 和**計算時間**。

*   **體素化過程:** `voxelize_geometry.py` 腳本會將整個 STL 檔案載入記憶體，然後根據您設定的 `voxel_size` 建立一個三維的體素網格。網格的大小與您的 STL 模型邊界框大小和 `voxel_size` 成反比。
    *   一個較小的 `voxel_size` 或一個較大的 STL 檔案會產生非常大的網格，從而消耗大量記憶體。
*   **LBM 模擬:** `lbm_solver_3d.py` 腳本會載入這個網格，並為模擬建立數個相同大小的 3D 場 (例如 `f`, `F`, `rho`, `v` 等)，這會進一步增加記憶體的使用量。同時，越大的網格也會導致模擬時間顯著增加。

**總結：** 您主要受到電腦 RAM 的限制。如果您嘗試用非常高的解析度 (很小的 `voxel_size`) 去模擬一個非常大的幾何模型，很可能會遇到記憶體不足的問題。

### 單位限制 (格子單位)

這是 LBM 模擬的一個關鍵概念。LBM 方法在一個稱為**格子單位 (lattice units)** 的系統中運作，而不是在真實世界的單位（如公尺或秒）中運作。

*   **這代表什麼：** 您在 `config.yml` 中設定的 `voxel_size` 定義了模擬的基本長度單位，通常表示為 `dx`。所有其他的物理量都根據這個格子單位進行縮放。
*   **STL 檔案的單位：** STL 檔案格式本身是**無單位**的。檔案中的數字代表座標，但它們是毫米、公尺還是英寸，則由使用者自行解釋。
*   **您的責任：** 您需要保持單位的一致性。當您設定 `voxel_size` 時，您實際上是在定義您的 CAD 模型單位與模擬格子單位之間的關係。

**範例：**

假設您的建築物 STL 檔案是以**公尺 (meters)** 作為單位建立的。

*   如果您在 `config.yml` 中設定 `voxel_size = 0.5`，那麼您模擬中的每一個體素就代表一個 `0.5m x 0.5m x 0.5m` 的空間方塊。
*   所有其他的模擬參數，如黏滯係數 (`niu`) 和外部力 (`fx`)，都是在這些格子單位中定義的。您需要使用適當的縮放定律（例如雷諾數匹配）來將這些格子單位的值與真實世界的物理值聯繫起來。

**總結：** 模擬本身與真實世界的單位無關。您需要自行處理 CAD 模型單位與模擬格子單位之間的轉換和縮放。
