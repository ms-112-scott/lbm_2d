
# LBM 2D 多通道數據生成腳本使用手冊

本手冊旨在說明如何使用 `main_multichannel.py` 腳本，以生成包含多個物理量通道的數據集，為您的深度學習研究提供更豐富的輸入特徵。

## 1. 快速開始

要開始生成多通道數據，您只需要執行 `main_multichannel.py` 腳本。

```bash
python lbm_2d/main_multichannel.py
```

腳本會自動讀取 `lbm_2d/config.yaml` 設定，掃描指定的 `mask` 遮罩檔案目錄，並為每一個遮罩圖形執行一次完整的模擬，最後將結果儲存於 `output/` 資料夾中。

## 2. 輸出數據結構

與原始腳本只輸出 2 通道的速度不同，此腳本生成的 `.npy` 檔案包含 **4 個通道**，其物理意義如下：

- **檔案形狀 (Shape):** `(nx, ny, 4)`
- **通道說明:**
    - **通道 0 (Vx):** X 方向的速度 (u)
    - **通道 1 (Vy):** Y 方向的速度 (v)
    - **通道 2 (Rho):** 流體密度 (ρ)
    - **通道 3 (Vorticity):** 渦度 (ω)，用於描述流體的旋轉程度

這個 4 通道的數據結構能讓您的神經網路模型學習到除了速度之外，更多關於流場狀態的關鍵資訊。

## 3. 模擬組態設定 (`config.yaml`)

所有的模擬參數都在 `lbm_2d/config.yaml` 檔案中進行設定。以下是一些關鍵參數：

- **`simulation.name`**: 此次批次模擬的名稱，輸出結果會被存放在 `output/<simulation_name>/` 目錄下。
- **`simulation.save_npy`**: 是否儲存 `.npy` 數據檔案。請確保將此設定為 `true`。
- **`simulation.save_step`**: 每隔多少個模擬步長儲存一次數據。
- **`obstacle.mask_dir`**: 存放幾何邊界定義的 `.png` 遮罩檔案的目錄路徑。腳本會遍歷此目錄下的所有 PNG 檔。

在執行腳本前，請先檢查並確認 `config.yaml` 的設定符合您的實驗需求。

## 4. 腳本檔案概覽

為了實現多通道輸出，我們創建了以下新檔案，它們與原始檔案並存，互不干擾：

- **`main_multichannel.py`**: **(主執行檔)** 這是您應該運行的主腳本。它負責啟動、管理整個批次模擬流程。
- **`engine_multichannel.py`**: **(核心引擎)** 包含了主要的模擬循環。我們修改了這個檔案，加入了計算密度 (`rho`) 和渦度 (`vorticity`) 的邏輯，並將多個物理量合併成一個 4 通道的 NumPy 陣列。
- **`utils_multichannel.py`**: **(工具函數)** 包含了輔助函數。我們修改了這裡的 `save_snapshot` 函數，使其能夠直接接收並儲存傳入的、已經組合好的多通道 NumPy 陣列。

## 5. 與原始腳本的區別

- **`main.py`**: 原始的主腳本。執行它將只會生成包含 `(Vx, Vy)` 的 **2 通道**數據。
- **`main_multichannel.py`**: 新增的主腳本。執行它會生成包含 `(Vx, Vy, Rho, Vorticity)` 的 **4 通道**數據。

您可以根據不同的實驗需求，選擇執行不同的主腳本。
